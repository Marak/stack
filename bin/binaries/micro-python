#!/usr/bin/env python

def __prepare():
    global code, service, Hook

    import sys
    import os.path
    sys.path.insert(0, os.path.join(os.path.dirname(sys.argv[0]), 'lib', 'python'))
    # print(sys.argv)
    # print(sys.path)

    if hasattr(sys.stdout, 'encoding') and not sys.stdout.encoding:
        sys.stdout.flush()
        import codecs
        out = sys.stdout
        sys.stdout = codecs.getwriter('UTF-8')(out, 'backslashreplace')
        sys.stdout.encoding = 'UTF-8'
        sys.stdout.buffer = out

    import microcule

    code, service, Hook = microcule.parse_argv()

__prepare()
del __prepare

# Execute the code as a string in ( this ) context
# print(code)
exec(code)
